import{r as y,j as t}from"./index-b2ef79c2.js";import{C as J,D as Le,E as ie,F as oe}from"./getScore-e285a266.js";import{U as Ne,D as Be,e as De}from"./save_excel-c19756b0.js";import{a as K}from"./axios-4a70c6fc.js";import{F as B}from"./index-172dc63e.js";import{M as ce,P as de,D as ue}from"./DeleteOutlined-d98d3dbe.js";import{S as me}from"./index-d41603e6.js";import{B as N,E as ze}from"./EditOutlined-8b010ab0.js";import{I as se,S as b,E as Me,a as Pe}from"./index-fa1a6c2a.js";import{T as p,a as Ue}from"./index-7b773b73.js";import{C as Ve}from"./index-08b925e2.js";import{S as $e}from"./SlidersOutlined-c8a2fa8c.js";import{L as Je}from"./index-5e132e59.js";import{n as M}from"./FileSaver.min-7cd7f937.js";import{m as he}from"./index-d3e2e81c.js";import{S as Ke}from"./SyncOutlined-620b68af.js";import"./useFlexGapSupport-2bb9cee6.js";import"./Sider-05241123.js";import"./row-431da211.js";import"./PlusOutlined-23b712b3.js";import"./index-5a7f0b26.js";async function ye(l,k){try{let d=`https://api.lineascan.build/api?module=account&action=balance&address=${l}&tag=latest&apikey=${k}`;const A=await K.get(d);return{balance:parseFloat(J(A.data.result)).toFixed(4)}}catch(d){return console.error(d),{balance:"Error"}}}function He(l){return`${l.getUTCFullYear()}-${l.getUTCMonth()+1}-${l.getUTCDate()}`}function Re(l){l=new Date(Date.UTC(l.getFullYear(),l.getMonth(),l.getDate())),l.setUTCDate(l.getUTCDate()+4-(l.getUTCDay()||7));let k=new Date(Date.UTC(l.getUTCFullYear(),0,1)),d=Math.ceil(((l-k)/864e5+1)/7);return l.getUTCFullYear()+"W"+d}function Ye(l){return l.getUTCFullYear()+"-"+(l.getUTCMonth()+1)}function Qe(l){const k=new Date(l),d=8,A=new Date(k.getTime()+d*3600*1e3),j=new Date,f=new Date(j.getTime()+d*3600*1e3)-A,c=Math.floor(f/(1e3*60*60)),w=Math.floor(c/24);return w>0?`${w} 天前`:c>0?`${c} 小时前`:"刚刚"}const We=async()=>{try{return(await K.post("https://mainnet.era.zksync.io/",{id:42,jsonrpc:"2.0",method:"zks_getTokenPrice",params:["0x0000000000000000000000000000000000000000"]})).data.result}catch(l){return console.log(l),1870}};async function ge(l,k){try{let d=new Set,A=new Set,j=new Set;l=l.toLowerCase();let T=`https://api.lineascan.build/api?module=account&action=txlist&address=${l}&startblock=1&endblock=99999999&sort=asc&apikey=${k}`,c=(await K.get(T)).data.result;c=c.filter(S=>S.from===l);let w=c.map(S=>S.to);w=[...new Set(w)];let C=c.map(S=>new Date(S.timeStamp*1e3));const P=C[C.length-1];C.forEach(S=>{d.add(He(S)),A.add(Re(S)),j.add(Ye(S))});const I=c.reduce((S,F)=>S+parseFloat(F.gasPrice)*parseFloat(F.gasUsed),0),D=J(I),U=c.reduce((S,F)=>S+parseFloat(J(F.value)),0),H=await We(),Y=U*H,R=c.length,V=Qe(P),Q=d.size,W=A.size,q=j.size,X=w.length;return{linea_tx_amount:R,linea_last_tx:V,dayActivity:Q,weekActivity:W,monthActivity:q,contractActivity:X,totalFee:parseFloat(D).toFixed(4),totalExchangeAmount:parseFloat(Y).toFixed(2)}}catch(d){return console.error(d),{linea_tx_amount:"Error",linea_last_tx:"Error",dayActivity:"Error",weekActivity:"Error",monthActivity:"Error",contractActivity:"Error",totalFee:"Error",totalExchangeAmount:"Error"}}}async function xe(l,k){var d;try{let A=`https://api.lineascan.build/api?module=account&action=tokenbalance&contractaddress=0x7d43AABC515C356145049227CeE54B608342c0ad&address=${l}&tag=latest&apikey=${k}`;const j=await K.get(A);return{BUSD:parseFloat(J((d=j.data)==null?void 0:d.result)).toFixed(2)}}catch(A){return console.error(A),{BUSD:"Error"}}}async function pe(l,k){try{let d=`https://api.lineascan.build/api?module=account&action=txlistinternal&address=${l}&startblock=0&endblock=2702578&sort=asc&apikey=${k}`;const T=(await K.get(d)).data.result.filter(w=>w.from==="0x508ca82df566dcd1b0de8296e70a96332cd644ec"&&(w==null?void 0:w.value)>3e14);if(T.length===0)return{l1Tol2Times:0,l1Tol2Amount:0};const f=T==null?void 0:T.length,c=T.reduce((w,C)=>w+parseFloat(J(C.value)),0);return{l1Tol2Times:f,l1Tol2Amount:c}}catch(d){return console.error(d),{l1Tol2Times:"Error",l1Tol2Amount:"Error"}}}const{Content:qe}=Je,{TextArea:Xe}=se;function _t(){const[l,k]=y.useState(0),[d,A]=y.useState(0),[j,T]=y.useState(!1),[f,c]=y.useState([]),[w,C]=y.useState(!1),[P]=B.useForm(),[I,D]=y.useState([]);B.useForm(),y.useState(!1);const[U,H]=y.useState(!1),[Y,R]=y.useState(!1),[V,Q]=y.useState(!1),[W,q]=y.useState([]),[X,S]=y.useState(0),[F]=B.useForm(),[E,re]=y.useState(localStorage.getItem("linea_api_key")),[fe,Z]=y.useState(!1),_e=()=>{Q(!V)},ke=()=>{localStorage.setItem("linea_api_key",F.getFieldsValue().linea),Z(!1),re(localStorage.getItem("linea_api_key"))};y.useEffect(()=>{const e=localStorage.getItem("linea_api_key");e&&(re(e),F.setFieldsValue(e))},[]);const we=()=>V?t.jsx(Me,{}):t.jsx(Pe,{});y.useEffect(()=>{const e=()=>{S(window.innerHeight-210)};return window.addEventListener("resize",e),e(),()=>{window.removeEventListener("resize",e)}},[]);const Se=async()=>{if(!I.length){M.error({message:"错误",description:"请先选择要刷新的地址"},2);return}H(!0);try{let n=0,r=[];const s=[...f],_=()=>{for(;n<2&&r.length>0;){const m=r.shift();n+=1,m().finally(()=>{n-=1,_()})}r.length>0&&setTimeout(_,2500)};for(let m of I){const g=s.findIndex(a=>a.key===m);if(g!==-1){const a=s[g];r.push(()=>(a.linea_eth_balance=null,ye(a.address,E).then(({balance:i})=>{a.linea_eth_balance=i,c([...s]),localStorage.setItem("linea_addresses",JSON.stringify(s))}))),r.push(async()=>(a.linea_busdBalance=null,xe(a.address,E).then(({BUSD:i})=>{a.linea_busdBalance=i,c([...s]),localStorage.setItem("linea_addresses",JSON.stringify(s))}))),r.push(()=>(a.linea_tx_amount=null,a.linea_last_tx=null,a.dayActivity=null,a.weekActivity=null,a.monthActivity=null,a.contractActivity=null,a.totalFee=null,ge(a.address,E).then(({linea_tx_amount:i,linea_last_tx:x,dayActivity:o,weekActivity:v,monthActivity:O,contractActivity:L,totalFee:u,totalExchangeAmount:h})=>{a.linea_tx_amount=i,a.linea_last_tx=x,a.dayActivity=o,a.weekActivity=v,a.monthActivity=O,a.contractActivity=L,a.totalFee=u,a.totalExchangeAmount=h,c([...s]),localStorage.setItem("linea_addresses",JSON.stringify(s))}))),r.push(()=>(a.eth_balance=null,ie(a.address,"ethereum").then(i=>{a.eth_balance=i,c([...s]),localStorage.setItem("linea_addresses",JSON.stringify(s))}))),r.push(()=>(a.eth_tx_amount=null,oe(a.address,"ethereum").then(i=>{a.eth_tx_amount=i,c([...s]),localStorage.setItem("linea_addresses",JSON.stringify(s))}))),r.push(()=>(a.l1Tol2Times=null,a.l1Tol2Amount=null,pe(a.address,E).then(({l1Tol2Times:i,l1Tol2Amount:x})=>{a.l1Tol2Times=i,a.l1Tol2Amount=x,c([...s]),localStorage.setItem("linea_addresses",JSON.stringify(s))})))}}_()}catch(e){M.error({message:"错误",description:e.message},2)}finally{H(!1),D([]),he.success("刷新成功")}},Ae=async()=>{try{T(!0),C(!1);const r=(await P.validateFields()).addresses.split(`
`).map(o=>{const[v,O]=o.split(",");return{address:v.trim(),name:O?O.trim():""}}),s=r.map(o=>o.address),_=r.map(o=>o.name);A(s.length);const m=[...f],g=3;let a=0,i=[];k(0);const x=()=>{for(;i.length>0&&a<g;){const o=i.shift();a+=1,o().finally(()=>{a-=1,x()})}};for(let o of s){o=o.trim();let v=_[s.indexOf(o)];if(o.length!==42){M.error({message:"错误",description:"请输入正确的地址"});continue}let O=()=>new Promise((h,z)=>{k($=>$+1),h()});const L=m.findIndex(h=>h.address===o),u=L!==-1?m[L]:{key:m.length.toString(),address:o,name:v,eth_balance:null,eth_tx_amount:null,linea_eth_balance:null,linea_last_tx:null,linea_tx_amount:null,linea_busdBalance:null,linea_usdtBalance:null,dayActivity:null,weekActivity:null,monthActivity:null,l1Tol2Times:null,l1Tol2Amount:null,l2Tol1Times:null,l2Tol1Amount:null,contractActivity:null,totalFee:null,totalExchangeAmount:null};L===-1&&m.push(u),i.push(()=>ye(o,E).then(({balance:h})=>{u.linea_eth_balance=h})),i.push(()=>xe(o,E).then(({BUSD:h})=>{u.linea_busdBalance=h})),i.push(()=>ie(o,"ethereum").then(h=>{u.eth_balance=h})),i.push(()=>oe(o,"ethereum").then(h=>{u.eth_tx_amount=h})),i.push(()=>ge(o,E).then(({linea_tx_amount:h,linea_last_tx:z,dayActivity:$,weekActivity:ee,monthActivity:te,contractActivity:ne,totalFee:ae,totalExchangeAmount:le})=>{u.linea_tx_amount=h,u.linea_last_tx=z,u.dayActivity=$,u.weekActivity=ee,u.monthActivity=te,u.contractActivity=ne,u.totalFee=ae,u.totalExchangeAmount=le})),i.push(()=>pe(o,E).then(({l1Tol2Times:h,l1Tol2Amount:z})=>{u.l1Tol2Times=h,u.l1Tol2Amount=z})),i.push(O),x()}for(;a>0||i.length>0;)await new Promise(o=>setTimeout(o,1e3));c(m),localStorage.setItem("linea_addresses",JSON.stringify(m))}catch(e){M.error({message:"错误",description:e.message})}finally{T(!1),k(0),P.resetFields(),D([]),he.success("地址添加成功")}},be=()=>{if(E===null){M.error({message:"请先填写API Key",description:"完成API配置 再添加地址",duration:10});return}C(!0)},Te=()=>{De(f,"walletInfo")};y.useEffect(()=>{R(!0);const e=localStorage.getItem("linea_addresses");setTimeout(()=>{R(!1)},500),e&&(c(JSON.parse(e)),q(JSON.parse(e)))},[]),y.useEffect(()=>{const e=[...f];for(const n of e)setTimeout(async()=>{const r=await Le(n);n.linea_score=r,e.every(_=>_.zk_score!==void 0)&&c(e)},0)},[W]);const je=e=>{c(f.filter(n=>n.key!==e)),localStorage.setItem("linea_addresses",JSON.stringify(f.filter(n=>n.key!==e)))},ve=()=>{if(!I.length){M.error({message:"错误",description:"请先选择要删除的地址"},2);return}c(f.filter(e=>!I.includes(e.key))),localStorage.setItem("linea_addresses",JSON.stringify(f.filter(e=>!I.includes(e.key)))),D([])},Ce={selectedRowKeys:I,onChange:e=>{D(e)}},Ie=()=>{C(!1)},[Ee,G]=y.useState(null),Fe=[{title:"#",key:"index",align:"center",render:(e,n,r)=>r+1,width:70},{title:"备注",dataIndex:"name",key:"name",align:"center",render:(e,n)=>n.key===Ee?t.jsx(se,{placeholder:"请输入备注",defaultValue:e,onPressEnter:s=>{n.name=s.target.value,c([...f]),localStorage.setItem("linea_addresses",JSON.stringify(f)),G(null)}}):t.jsxs(t.Fragment,{children:[t.jsx(Ue,{color:"blue",onClick:()=>G(n.key),children:e}),!e&&t.jsx(N,{shape:"circle",icon:t.jsx(ze,{}),size:"small",onClick:()=>G(n.key)})]}),width:90},{title:t.jsxs("span",{children:["钱包地址",t.jsx("span",{onClick:_e,style:{marginLeft:8,cursor:"pointer"},children:we()})]}),dataIndex:"address",key:"address",align:"center",render:(e,n)=>V?"***":e,width:360},{title:"ETH",key:"eth_group",className:"zks_eth",children:[{title:"ETH",dataIndex:"eth_balance",key:"eth_balance",align:"center",render:(e,n)=>e===null?t.jsx(b,{}):e,width:80},{title:"Tx",dataIndex:"eth_tx_amount",key:"eth_tx_amount",align:"center",render:(e,n)=>e===null?t.jsx(b,{}):e,width:80}]},{title:"Linea Mainnet",key:"zks_era_group",className:"zks_era",children:[{title:"ETH",dataIndex:"linea_eth_balance",key:"linea_eth_balance",align:"center",render:(e,n)=>e===null?t.jsx(b,{}):e,width:80},{title:"BUSD",dataIndex:"linea_busdBalance",key:"linea_busdBalance",align:"center",render:(e,n)=>e===null?t.jsx(b,{}):e,width:80},{title:"Tx",dataIndex:"linea_tx_amount",key:"linea_tx_amount",align:"center",sorter:(e,n)=>e.linea_tx_amount-n.linea_tx_amount,render:(e,n)=>{if(e===null)return t.jsx(b,{});const r=Math.log(e),s=Math.log(1),_=Math.log(100),m=(r-s)/(_-s),g=.1,x=`rgba(173, 216, 230, ${m*(1-g)+g})`;return{children:e,props:{style:{background:x}}}},width:60},{title:"最后交易",dataIndex:"linea_last_tx",key:"linea_last_tx",align:"center",render:(e,n)=>{let r="inherit";return e===null?t.jsx(b,{}):(e!=null&&e.includes("天")&&parseInt(e)>7?r="red":r="#1677ff",t.jsx("a",{href:"https://lineascan.build/address/"+n.address,target:"_blank",style:{color:r},children:e}))},width:90},{title:"官方桥跨链Tx数",key:"cross_chain_tx_count_group",children:[{title:"L1->L2",dataIndex:"l1Tol2Times",key:"l1Tol2Times",align:"center",sorter:(e,n)=>e.l1Tol2Times-n.l1Tol2Times,render:(e,n)=>e===null?"/":e,width:70},{title:"L2->L1",dataIndex:"l2Tol1Times",key:"l2Tol1Times",align:"center",render:(e,n)=>e===null?"/":e,width:60}]},{title:"官方桥跨链金额",key:"cross_chain_amount_group",children:[{title:"L1->L2",dataIndex:"l1Tol2Amount",key:"l1Tol2Amount",align:"center",render:(e,n)=>e===null?"/":e,width:60},{title:"L2->L1",dataIndex:"l2Tol1Amount",key:"l2Tol1Amount",align:"center",render:(e,n)=>e===null?"/":e,width:60}]},{title:"活跃统计",key:"activity_stats_group",children:[{title:"日",dataIndex:"dayActivity",key:"dayActivity",align:"center",sorter:(e,n)=>e.dayActivity-n.dayActivity,render:(e,n)=>e===null?t.jsx(b,{}):e,width:55},{title:"周",dataIndex:"weekActivity",key:"weekActivity",align:"center",sorter:(e,n)=>e.weekActivity-n.weekActivity,render:(e,n)=>e===null?t.jsx(b,{}):e,width:55},{title:"月",dataIndex:"monthActivity",key:"monthActivity",align:"center",render:(e,n)=>e===null?t.jsx(b,{}):e,width:55},{title:"不同合约",dataIndex:"contractActivity",key:"contractActivity",align:"center",render:(e,n)=>e===null?t.jsx(b,{}):e,width:90},{title:"金额(U)",dataIndex:"totalExchangeAmount",key:"totalExchangeAmount",align:"center",sorter:(e,n)=>e.totalExchangeAmount-n.totalExchangeAmount,render:(e,n)=>{if(e===null)return"/";const r=Math.log(e),s=Math.log(1),_=Math.log(100),m=(r-s)/(_-s),g=.1,x=`rgba(211, 211, 211, ${m*(1-g)+g})`;return{children:e,props:{style:{background:x}}}},width:90},{title:"FeeΞ",dataIndex:"totalFee",key:"totalFee",align:"center",render:(e,n)=>e===null?t.jsx(b,{}):e,width:80}]}]},{title:"评分",dataIndex:"linea_score",key:"linea_score",align:"center",sorter:(e,n)=>e.linea_score-n.linea_score,render:(e,n)=>{if(e===null)return t.jsx(b,{});const r=Math.log(e),s=Math.log(1),_=Math.log(100),m=(r-s)/(_-s),g=.1,x=`rgba(240, 121, 78, ${m*(1-g)+g})`;return{children:e,props:{style:{background:x}}}},width:70},{title:"操作",key:"action",align:"center",render:(e,n)=>t.jsx(me,{size:"small",children:t.jsx(de,{title:"确认删除？",onConfirm:()=>je(n.key),children:t.jsx(N,{icon:t.jsx(ue,{})})})}),width:70}];return t.jsx("div",{children:t.jsxs(qe,{children:[t.jsx(ce,{title:"批量添加地址",open:w,onOk:Ae,onCancel:Ie,okButtonProps:{loading:U},okText:"添加地址",cancelText:"取消",children:t.jsx(B,{form:P,layout:"vertical",children:t.jsx(B.Item,{label:"地址",name:"addresses",rules:[{required:!0}],children:t.jsx(Xe,{placeholder:"请输入地址，每行一个  要添加备注时放在地址后以逗号(,)间隔",style:{width:"500px",height:"200px"}})})})}),t.jsx(ce,{title:t.jsxs(t.Fragment,{children:[t.jsx("div",{children:"更换API Key"}),t.jsx("div",{style:{fontSize:"12px",color:"#888"},children:t.jsx(me,{children:t.jsx(N,{type:"link",onClick:()=>window.open("https://lineascan.build/myapikey","_blank"),children:"注册Lineascan API"})})})]}),open:fe,onOk:ke,onCancel:()=>Z(!1),okText:"确定",cancelText:"取消",children:t.jsx(B,{form:F,layout:"horizontal",children:t.jsx(B.Item,{label:"Linea",name:"linea",children:t.jsx(se,{placeholder:"请输入Lineascan API Key"})})})}),t.jsx(b,{spinning:Y,children:t.jsx(p,{rowSelection:Ce,dataSource:f,pagination:!1,bordered:!0,style:{marginBottom:"0px",zIndex:2},size:"small",columns:Fe,scroll:{y:X},summary:e=>{let n=0,r=0,s=0,_=0,m=0,g=0,a=0,i=0,x=0,o=0,v=0;e.forEach(({eth_balance:L,linea_eth_balance:u,linea_busdBalance:h,linea_tx_amount:z,totalFee:$,dayActivity:ee,weekActivity:te,monthActivity:ne,contractActivity:ae,totalExchangeAmount:le,linea_score:Oe})=>{n+=Number(L),r+=Number(u),s+=Number(h),_+=Number($),m+=Number(z),g+=Number(ee),a+=Number(te),i+=Number(ne),x+=Number(ae),o+=Number(le),v+=Number(Oe)}),m=m/e.length,g=g/e.length,a=a/e.length,i=i/e.length,x=x/e.length,o=o/e.length,v=v/e.length;const O=Array(5).fill().map((L,u)=>t.jsx(p.Summary.Cell,{index:u+11},u));return t.jsx(t.Fragment,{children:t.jsxs(p.Summary.Row,{children:[t.jsx(p.Summary.Cell,{index:0,colSpan:4,children:"总计"}),t.jsx(p.Summary.Cell,{index:4,children:n.toFixed(4)}),t.jsx(p.Summary.Cell,{index:5}),t.jsx(p.Summary.Cell,{index:8,children:r.toFixed(4)}),t.jsx(p.Summary.Cell,{index:9,children:s.toFixed(2)}),t.jsxs(p.Summary.Cell,{index:11,children:["-",m.toFixed(0),"-"]}),O,t.jsxs(p.Summary.Cell,{index:17,children:["-",g.toFixed(0),"-"]}),t.jsxs(p.Summary.Cell,{index:18,children:["-",a.toFixed(0),"-"]}),t.jsxs(p.Summary.Cell,{index:19,children:["-",i.toFixed(0),"-"]}),t.jsxs(p.Summary.Cell,{index:20,children:["-",x.toFixed(0),"-"]}),t.jsxs(p.Summary.Cell,{index:21,children:["-",o.toFixed(0),"-"]}),t.jsx(p.Summary.Cell,{index:22,children:_.toFixed(4)}),t.jsxs(p.Summary.Cell,{index:23,children:["-",v.toFixed(0),"-"]}),t.jsx(p.Summary.Cell,{index:24})]})})},footer:()=>t.jsx(Ve,{children:t.jsxs("div",{style:{width:"100%",display:"flex",justifyContent:"space-between",gap:"20px"},children:[t.jsx(N,{type:"primary",onClick:Se,loading:U,size:"large",style:{width:"20%"},icon:t.jsx(Ke,{}),children:U?"正在刷新":"刷新选中地址"}),t.jsx(N,{type:"primary",onClick:be,size:"large",style:{width:"20%"},icon:t.jsx(Ne,{}),loading:j,children:j?`添加中 进度:(${l}/${d})`:"添加地址"}),t.jsx(N,{type:"primary",onClick:()=>{Z(!0)},size:"large",style:{width:"20%"},icon:t.jsx($e,{}),children:"更换API KEY"}),t.jsx(de,{title:"确认删除"+I.length+"个地址？",onConfirm:ve,children:t.jsx(N,{type:"primary",danger:!0,size:"large",style:{width:"20%"},icon:t.jsx(ue,{}),children:"删除选中地址"})}),t.jsx(N,{type:"primary",icon:t.jsx(Be,{}),size:"large",style:{width:"8%"},onClick:Te})]})})})})]})})}export{_t as default};
